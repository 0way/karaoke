!function(){"use strict";function t(t,e){return!e&&t instanceof Array?t:Array.prototype.slice.call(t)}function e(t,e){return void 0!==t?t:e}function n(t,i,r,f){if(t instanceof n){var s=t.slice(i,i+r);return s._littleEndian=e(f,s._littleEndian),s}if(!(this instanceof n))return new n(t,i,r,f);if(this.buffer=t=n.wrapBuffer(t),this._isArrayBuffer=v.ArrayBuffer&&t instanceof ArrayBuffer,this._isPixelData=v.PixelData&&t instanceof CanvasPixelArray,this._isDataView=v.DataView&&this._isArrayBuffer,this._isNodeBuffer=v.NodeBuffer&&t instanceof Buffer,!(this._isNodeBuffer||this._isArrayBuffer||this._isPixelData||t instanceof Array))throw new TypeError("jDataView buffer has an incompatible type");this._littleEndian=!!f;var o="byteLength"in t?t.byteLength:t.length;this.byteOffset=i=e(i,0),this.byteLength=r=e(r,o-i),this._isDataView?this._view=new DataView(t,i,r):this._checkBounds(i,r,o),this._engineAction=this._isDataView?this._dataViewAction:this._isNodeBuffer?this._nodeBufferAction:this._isArrayBuffer?this._arrayBufferAction:this._arrayAction}function i(t){if(v.NodeBuffer)return new Buffer(t,"binary");for(var e=v.ArrayBuffer?Uint8Array:Array,n=new e(t.length),i=0,r=t.length;i<r;i++)n[i]=255&t.charCodeAt(i);return n}function r(t){return t>=0&&t<31?1<<t:r[t]||(r[t]=Math.pow(2,t))}function f(t,e){this.lo=t,this.hi=e}function s(){f.apply(this,arguments)}function o(){var t=document.getElementById("filedrag"),e=document.getElementById("fileselect"),n=document.getElementById("disable-filter"),i=document.getElementById("demo-audio");I=document.getElementById("options"),e.addEventListener("change",c,!1);var r=new XMLHttpRequest;r.upload?(t.addEventListener("dragover",u,!1),t.addEventListener("dragleave",u,!1),t.addEventListener("drop",c,!1),t.style.display="block"):t.style.display="none";var f=!0;n.addEventListener("click",function(){f?(_(),f=!1,n.innerHTML="Enable karaoke"):(g(),f=!0,n.innerHTML="Disable karaoke")}),i.addEventListener("click",function(){a("audio/mmo-happy.mp3")},!1)}function a(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){var t=e.response;h(t)},e.send()}function u(t){t.stopPropagation(),t.preventDefault(),t.target.className="dragover"===t.type?"hover":""}function c(t){u(t);var e=t.target.files||t.dataTransfer.files,i=new FileReader;i.onload=function(t){var e=t.target.result;h(e);var i=document.getElementById("current-song"),r=new n(this.result);if("TAG"==r.getString(3,r.byteLength-128)){var f=r.getString(30,r.tell()),s=r.getString(30,r.tell());i.innerHTML="Playing "+f+" by "+s}else i.innerHTML="Playing";I.style.display="block"},i.readAsArrayBuffer(e[0])}function h(t){E&&E.stop(0),E=O.createBufferSource(),O.decodeAudioData?O.decodeAudioData(t,function(t){E.buffer=t,l()}):(E.buffer=O.createBuffer(t,!1),l())}function l(){D=O.createBiquadFilter(),E.connect(D),D.type="lowpass",D.frequency.value=120,L=O.createBiquadFilter(),E.connect(L),L.type="highpass",L.frequency.value=120,N=O.createGain(),F=O.createGain(),E.connect(F),F.connect(O.destination),N.gain.value=1,F.gain.value=0,U=O.createScriptProcessor(2048,2,1),L.connect(U),D.connect(N),U.connect(N),N.connect(O.destination),U.onaudioprocess=d,E.start(0),setTimeout(y,1e3*E.buffer.duration+1e3)}function y(){E.stop(0),E.disconnect(0),U.disconnect(0),N.disconnect(0),F.disconnect(0),L.disconnect(0),D.disconnect(0)}function d(t){for(var e=t.inputBuffer.getChannelData(0),n=t.inputBuffer.getChannelData(1),i=t.outputBuffer.getChannelData(0),r=e.length,f=0;f<r;f++)i[f]=e[f]-n[f]}function _(){F.gain.value=1,N.gain.value=0}function g(){N.gain.value=1,F.gain.value=0}var B=window,v={NodeBuffer:"Buffer"in B&&"readInt16LE"in Buffer.prototype,DataView:"DataView"in B&&("getFloat64"in DataView.prototype||"getFloat64"in new DataView(new ArrayBuffer(1))),ArrayBuffer:"ArrayBuffer"in B,PixelData:"CanvasPixelArray"in B&&"ImageData"in B&&"document"in B};if(v.PixelData){var p=function(t,e){var n=p.context2d.createImageData((t+3)/4,1).data;if(n.byteLength=t,void 0!==e)for(var i=0;i<t;i++)n[i]=e[i];return n};p.context2d=document.createElement("canvas").getContext("2d")}var w={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8},b={Int8:"Int8",Int16:"Int16",Int32:"Int32",Uint8:"UInt8",Uint16:"UInt16",Uint32:"UInt32",Float32:"Float",Float64:"Double"};n.wrapBuffer=function(e){switch(typeof e){case"number":if(v.NodeBuffer)e=new Buffer(e),e.fill(0);else if(v.ArrayBuffer)e=new Uint8Array(e).buffer;else if(v.PixelData)e=p(e);else{e=new Array(e);for(var n=0;n<e.length;n++)e[n]=0}return e;case"string":e=i(e);default:return"length"in e&&!(v.NodeBuffer&&e instanceof Buffer||v.ArrayBuffer&&e instanceof ArrayBuffer||v.PixelData&&e instanceof CanvasPixelArray)&&(e=v.NodeBuffer?new Buffer(e):v.ArrayBuffer?e instanceof ArrayBuffer?e:new Uint8Array(e).buffer:v.PixelData?p(e.length,e):t(e)),e}},n.createBuffer=function(){return n.wrapBuffer(arguments)},n.Uint64=f,f.prototype={valueOf:function(){return this.lo+r(32)*this.hi},toString:function(){return Number.prototype.toString.apply(this.valueOf(),arguments)}},f.fromNumber=function(t){var e=Math.floor(t/r(32)),n=t-e*r(32);return new f(n,e)},n.Int64=s,s.prototype="create"in Object?Object.create(f.prototype):new f,s.prototype.valueOf=function(){return this.hi<r(31)?f.prototype.valueOf.apply(this,arguments):-(r(32)-this.lo+r(32)*(r(32)-1-this.hi))},s.fromNumber=function(t){var e,n;if(t>=0){var i=f.fromNumber(t);e=i.lo,n=i.hi}else n=Math.floor(t/r(32)),e=t-n*r(32),n+=r(32);return new s(e,n)},n.prototype={_offset:0,compatibility:v,_checkBounds:function(t,n,i){if("number"!=typeof t)throw new TypeError("Offset is not a number.");if("number"!=typeof n)throw new TypeError("Size is not a number.");if(n<0)throw new RangeError("Length is negative.");if(t<0||t+n>e(i,this.byteLength))throw new RangeError("Offsets are out of bounds.")},_action:function(t,n,i,r,f){return this._engineAction(t,n,e(i,this._offset),e(r,this._littleEndian),f)},_dataViewAction:function(t,e,n,i,r){return this._offset=n+w[t],e?this._view["get"+t](n,i):this._view["set"+t](n,r,i)},_nodeBufferAction:function(t,e,n,i,r){this._offset=n+w[t];var f=b[t]+("Int8"===t||"Uint8"===t?"":i?"LE":"BE");return n+=this.byteOffset,e?this.buffer["read"+f](n):this.buffer["write"+f](r,n)},_arrayBufferAction:function(t,e,n,i,r){var f,s=w[t],o=B[t+"Array"];if(1===s||(this.byteOffset+n)%s===0&&i)return f=new o(this.buffer,this.byteOffset+n,1),this._offset=n+s,e?f[0]:f[0]=r;var a=new Uint8Array(e?this._getBytes(s,n,i):s);return f=new o(a.buffer,0,1),e?f[0]:(f[0]=r,void this._setBytes(n,a,i))},_arrayAction:function(t,e,n,i,r){return e?this["_get"+t](n,i):this["_set"+t.replace("Uint","Int")](n,r,i)},_getBytes:function(n,i,r){r=e(r,this._littleEndian),i=e(i,this._offset),n=e(n,this.byteLength-i),this._checkBounds(i,n),i+=this.byteOffset,this._offset=i-this.byteOffset+n;var f=this._isArrayBuffer?new Uint8Array(this.buffer,i,n):(this.buffer.slice||Array.prototype.slice).call(this.buffer,i,i+n);return r||n<=1?f:t(f).reverse()},getBytes:function(n,i,r,f){var s=this._getBytes(n,i,e(r,!0));return f?t(s):s},_setBytes:function(n,i,r){var f=i.length;if(0!==f){if(r=e(r,this._littleEndian),n=e(n,this._offset),this._checkBounds(n,f),!r&&f>1&&(i=t(i,!0).reverse()),n+=this.byteOffset,this._isArrayBuffer)new Uint8Array(this.buffer,n,f).set(i);else if(this._isNodeBuffer)new Buffer(i).copy(this.buffer,n);else for(var s=0;s<f;s++)this.buffer[n+s]=i[s];this._offset=n-this.byteOffset+f}},setBytes:function(t,n,i){this._setBytes(t,n,e(i,!0))},writeBytes:function(t,e){this.setBytes(void 0,t,e)},getString:function(t,n,i){if(this._isNodeBuffer)return n=e(n,this._offset),t=e(t,this.byteLength-n),this._checkBounds(n,t),this._offset=n+t,this.buffer.toString(i||"binary",this.byteOffset+n,this.byteOffset+this._offset);var r=this._getBytes(t,n,!0),f="";t=r.length;for(var s=0;s<t;s++)f+=String.fromCharCode(r[s]);return"utf8"===i&&(f=decodeURIComponent(escape(f))),f},setString:function(t,n,r){return this._isNodeBuffer?(t=e(t,this._offset),this._checkBounds(t,n.length),void(this._offset=t+this.buffer.write(n,this.byteOffset+t,r||"binary"))):("utf8"===r&&(n=unescape(encodeURIComponent(n))),void this._setBytes(t,i(n),!0))},writeString:function(t,e){this.setString(void 0,t,e)},getChar:function(t){return this.getString(1,t)},setChar:function(t,e){this.setString(t,e)},writeChar:function(t){this.setChar(void 0,t)},tell:function(){return this._offset},seek:function(t){return this._checkBounds(t,0),this._offset=t},skip:function(t){return this.seek(this._offset+t)},slice:function(t,e,i){return i?new n(this.getBytes(e-t,t,!0,!0),void 0,void 0,this._littleEndian):new n(this.buffer,this.byteOffset+t,e-t,this._littleEndian)},_getFloat64:function(t,e){var n=this._getBytes(8,t,e),i=1-2*(n[7]>>7),f=((n[7]<<1&255)<<3|n[6]>>4)-1023,s=(15&n[6])*r(48)+n[5]*r(40)+n[4]*r(32)+n[3]*r(24)+n[2]*r(16)+n[1]*r(8)+n[0];return 1024===f?0!==s?NaN:i*(1/0):f===-1023?i*s*r(-1074):i*(1+s*r(-52))*r(f)},_getFloat32:function(t,e){var n=this._getBytes(4,t,e),i=1-2*(n[3]>>7),f=(n[3]<<1&255|n[2]>>7)-127,s=(127&n[2])<<16|n[1]<<8|n[0];return 128===f?0!==s?NaN:i*(1/0):f===-127?i*s*r(-149):i*(1+s*r(-23))*r(f)},_get64:function(t,n,i){i=e(i,this._littleEndian),n=e(n,this._offset);for(var r=i?[0,4]:[4,0],f=0;f<2;f++)r[f]=this.getUint32(n+r[f],i);return this._offset=n+8,new t(r[0],r[1])},getInt64:function(t,e){return this._get64(s,t,e)},getUint64:function(t,e){return this._get64(f,t,e)},_getInt32:function(t,e){var n=this._getBytes(4,t,e);return n[3]<<24|n[2]<<16|n[1]<<8|n[0]},_getUint32:function(t,e){return this._getInt32(t,e)>>>0},_getInt16:function(t,e){return this._getUint16(t,e)<<16>>16},_getUint16:function(t,e){var n=this._getBytes(2,t,e);return n[1]<<8|n[0]},_getInt8:function(t){return this._getUint8(t)<<24>>24},_getUint8:function(t){return this._getBytes(1,t)[0]},_setBinaryFloat:function(t,e,n,i,f){var s,o,a=e<0?1:0,u=~(-1<<i-1),c=1-u;e<0&&(e=-e),0===e?(s=0,o=0):isNaN(e)?(s=2*u+1,o=1):e===1/0?(s=2*u+1,o=0):(s=Math.floor(Math.log(e)/Math.LN2),s>=c&&s<=u?(o=Math.floor((e*r(-s)-1)*r(n)),s+=u):(o=Math.floor(e/r(c-n)),s=0));for(var h=[];n>=8;)h.push(o%256),o=Math.floor(o/256),n-=8;for(s=s<<n|o,i+=n;i>=8;)h.push(255&s),s>>>=8,i-=8;h.push(a<<i|s),this._setBytes(t,h,f)},_setFloat32:function(t,e,n){this._setBinaryFloat(t,e,23,8,n)},_setFloat64:function(t,e,n){this._setBinaryFloat(t,e,52,11,n)},_set64:function(t,n,i,r){i instanceof t||(i=t.fromNumber(i)),r=e(r,this._littleEndian),n=e(n,this._offset);var f=r?{lo:0,hi:4}:{lo:4,hi:0};for(var s in f)this.setUint32(n+f[s],i[s],r);this._offset=n+8},setInt64:function(t,e,n){this._set64(s,t,e,n)},writeInt64:function(t,e){this.setInt64(void 0,t,e)},setUint64:function(t,e,n){this._set64(f,t,e,n)},writeUint64:function(t,e){this.setUint64(void 0,t,e)},_setInt32:function(t,e,n){this._setBytes(t,[255&e,e>>>8&255,e>>>16&255,e>>>24],n)},_setInt16:function(t,e,n){this._setBytes(t,[255&e,e>>>8&255],n)},_setInt8:function(t,e){this._setBytes(t,[255&e])}};var A=n.prototype;for(var m in w)!function(t){A["get"+t]=function(e,n){return this._action(t,!0,e,n)},A["set"+t]=function(e,n,i){this._action(t,!1,e,i,n)},A["write"+t]=function(e,n){this["set"+t](void 0,e,n)}}(m);var I;window.File&&window.FileList&&window.FileReader?o():alert("Your browser does not support File");var E,U,D,L,N,F,O=new(window.AudioContext||window.webkitAudioContext)}();